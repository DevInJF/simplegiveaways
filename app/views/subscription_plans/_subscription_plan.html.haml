- is_current_plan = sub_object && sub_object.subscription_plan && sub_object.subscription_plan.id == subscription_plan.id

- is_next_plan = sub_object && sub_object.next_plan && sub_object.next_plan_id == subscription_plan.id

.five.wide.column
  .subscription-plan{id: subscription_plan.stripe_subscription_id, class: "#{is_current_plan ? 'current-subscription' : ''}", data: { description: subscription_plan.name, original_amount: subscription_plan.price_in_cents_per_cycle, checkout_amount: subscription_plan.price_in_cents_per_cycle, subscription_plan_id: subscription_plan.id, is_single_page: "#{subscription_plan.is_single_page?}", is_next_plan: "#{is_next_plan}", is_current_plan: "#{is_current_plan}" }}
    .ui.top.attached.segment
      .ui.header
        .number.price= price_label(subscription_plan)
    .ui.inverted.teal.attached.segment.plan-name
      %h5.ui.header
        = basic_plan_name_string(subscription_plan)
    .ui.bottom.attached.stacked.segment
      .ui.divided.selection.list.plan-features
        .item= page_count_feature_string(subscription_plan)
        .item= giveaway_count_feature_string(subscription_plan)
        .item Advanced Analytics
        .item Giveaway Shortlink
        .item= white_label_feature_string(subscription_plan)
      .pages
        - if is_current_plan && subscription_plan.is_multi_page?
          %h5.ui.icon.header
            %i.info.icon
            You are currently subscribed to this plan.
        - elsif is_next_plan && subscription_plan.is_multi_page?
          %h5.ui.icon.header
            %i.info.icon
            Your subscription will be downgraded to this plan on #{sub_object.subscription.activate_next_after}.
        - else
          %form.ui.fluid.form
            %legend Choose a Page
            .ui.divider
            - current_user.facebook_pages.sort_by { |p| p.name.size }.each do |page|
              .field
                .ui.radio.checkbox{class: (sub_object == page || is_current_plan && sub_object.subscription.facebook_pages.include?(page)) ? 'default' : 'resetable'}
                  = radio_button_tag "#{subscription_plan.name.parameterize}[pages]", page.id, (sub_object == page || is_current_plan && sub_object.subscription.facebook_pages.include?(page))
                  = label_tag "#{subscription_plan.name.parameterize}[pages][#{page.id}]", page.name
            .form-actions
              .ui.two.fluid.buttons
                .ui.icon.button.remove
                  %i.remove.icon
                .ui.teal.icon.button.check
                  %i.check.icon

  - if is_current_plan

    - if sub_object.subscription.cancellation_pending?

      %span.ui.tiny.disabled.button.cancel-subscription.popup-trigger{'data-title' => "Will be cancelled on #{sub_object.subscription.activate_next_after}."}
        Cancellation Pending

    - else

      = link_to 'Unsubscribe', user_unsubscribe_path(current_user), class: 'ui tiny button cancel-subscription', 'data-confirm' => 'Are you sure you want to cancel your subscription? If you continue, you will be able to enjoy the benfits of your subscription until the end of the current billing cycle.'

  - if is_next_plan

    - if sub_object.subscription.downgrade_pending?

      %span.ui.tiny.disabled.button.cancel-subscription.popup-trigger{'data-title' => "Will be downgraded on #{sub_object.subscription.activate_next_after}."}
        Downgrade Pending
